swagger: "2.0"
info:
  description: REST API for [NLPCraft](https://nlpcraft.org) - an open source library for adding Natural Language Interface to any applications. For Data Model APIs see [Javadoc](http://nlpcraft.org/apis/latest/index.html) documentation.
  version: 0.1.0
  title: NLPCraft API
host: localhost:8081
basePath: /api/v1
schemes:
  - http
consumes:
  - application/json
produces:
  - application/json
tags:
  - name: Authentication
    description: >-
      User signing in (getting access token), singing out and password reset.
  - name: Data Sources
    description: >-
      Adding, removing and managing data sources.
  - name: Users
    description: >-
      Adding, removing and managing users.
  - name: Data Probe
    description: >-
      Managing data probes.
  - name: Asking
    description: >-
      Asking questions, checking results, clearing conversation context.
      Managing result notification endpoints.
paths:
  /clear/conversation:
    post:
      tags:
        - Asking
      summary: Clears conversation context.
      description: Clears conversation context for given user and data source.
      operationId: clearConversation
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - dsId
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
              dsId:
                type: integer
                format: int64
                description: Data source ID for which to clear conversation context
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /check:
    post:
      tags:
        - Asking
      summary: Gets status of submitted requests.
      description: Gets the status of the previously submitted requests.
      operationId: check
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
              - states
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
              states:
                type: array
                items:
                  type: object
                  required:
                    - srvReqId
                    - txt
                    - userId
                    - dsId
                    - mdlId
                    - status
                    - error
                    - errorCode
                    - createTstamp
                    - updateTstamp
                  properties:
                    srvReqId:
                      type: string
                      description: Server request ID
                    txt:
                      type: string
                      description: Original request text
                    userId:
                      type: integer
                      format: int64
                      description: ID of the user that submitted the request
                    dsId:
                      type: integer
                      format: int64
                      description: ID of the data source for this request
                    mdlId:
                      type: string
                      description: ID of the model
                    probeId:
                      type: string
                      description: ID of the data probe
                    status:
                      type: string
                      description: >-
                        Current status of this request (QRY_READY indicates that
                        result - error or ok - is ready)
                      enum:
                        - QRY_ENLISTED
                        - QRY_READY
                    resType:
                      type: string
                      description: >-
                        Optional result type if returned by model (provided only
                        if status is QRY_READY and processing was not rejected
                        or terminated due to an exception)
                    resBody:
                      type: object
                      description: >-
                        Optional body (string or JSON object) of the result if returned by model
                        (provided only if status is QRY_READY and processing was
                        not rejected or terminated due to an exception)
                    error:
                      type: string
                      description: >-
                        Optional error if returned by model (provided only if
                        status is QRY_READY and processing was rejected or
                        terminated due to an exception)
                    errorCode:
                      type: integer
                      format: int32
                      description: >-
                        Optional error code indicating a type of error. Only present
                        of 'error' field is present.
                    createTstamp:
                      type: integer
                      format: int64
                      description: Creation UTC/GMT timestamp of the request
                    updateTstamp:
                      type: integer
                      format: int64
                      description: Last update UTC/GMT timestamp of the request
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /cancel:
    post:
      tags:
        - Asking
      summary: Cancels a question.
      description: >-
        Cancels the previously submitted sentence. Must be called when query
        result is no longer needed (i.e. downloaded by all client apps) to release the server memory.
        Note that query results will auto-expire on server after certain period of time.
      operationId: cancel
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
              srvReqIds:
                type: array
                items:
                  type: string
                description: Server IDs of the requests to cancel. Optional, all current user requests will cancel by default.
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /ask:
    post:
      tags:
        - Asking
      summary: Asks a question.
      description: Submits the sentence to be processed.
      operationId: ask
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - txt
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
              txt:
                type: string
                description: Text of the question
                maxLength: 1024
              dsId:
                type: integer
                format: int64
                description: >-
                  Data source ID. Cannot be used together with `mdlId`
                  parameter.
              mdlId:
                type: string
                description: >-
                  Model ID. Temporary data source for given model ID will be
                  created and deleted. Cannot be used together with `dsId`
                  parameter. Note also that when model ID is used instead of data source ID
                  the conversational context cannot be maintained (as it is maintained based
                  on data source ID which gets created and destroyed with every request in
                  such case). In most cases you should use non-temporary data source ID.
                maxLength: 32
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
              - srvReqId
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
              srvReqId:
                type: integer
                format: int64
                description: Server ID assigned to the new processing request
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /user/all:
    post:
      tags:
        - Users
      summary: Gets all users.
      description: Gets all users. Admin privileges required.
      operationId: getAllUsers
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
            properties:
              acsTok:
                maxLength: 256
                description: Access token obtain via '/api/signin' call
                type: string
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
              - users
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
              users:
                type: array
                items:
                  type: object
                  required:
                    - id
                    - email
                    - firstName
                    - lastName
                    - avatarUrl
                    - lastDsId
                    - isAdmin
                  properties:
                    id:
                      description: User ID
                      type: integer
                      format: int64
                    email:
                      description: User email
                      type: string
                    firstName:
                      description: User first or given name
                      type: string
                    lastName:
                      description: User last name
                      type: string
                    avatarUrl:
                      description: User avatar URL
                      type: string
                    lastDsId:
                      description: ID of the last used data source
                      type: integer
                      format: int64
                    isAdmin:
                      description: Whether or not user has admin privileges
                      type: boolean
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /user/update:
    post:
      tags:
        - Users
      summary: Updates regular user.
      description: >-
        Updates user with given ID or the current user with given parameters.
        Admin privileges required for updating other user.
      operationId: updateUser
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - firstName
              - lastName
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
              id:
                description: >-
                  Optional ID of the user to update. Only administrators can
                  provide this parameter. User's own ID by default.
                type: integer
                format: int64
              firstName:
                type: string
                description: User first or given name
                maxLength: 64
              lastName:
                type: string
                description: User last name
                maxLength: 64
              avatarUrl:
                type: string
                description: Optional user avatar URL
                maxLength: 512000
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /user/delete:
    post:
      tags:
        - Users
      summary: Deletes user.
      description: >-
        Deletes user with given ID or the current user.
        Admin privileges required for deleting other user.
      operationId: deleteUser
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
            properties:
              acsTok:
                maxLength: 256
                description: Access token obtain via '/api/signin' call
                type: string
              id:
                description: >-
                  Optional ID of the user to delete. Only administrators can
                  provide this parameter. User's own ID by default.
                type: integer
                format: int64
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /user/admin:
    post:
      tags:
        - Users
      summary: Updates user admin permissions.
      description: >-
        Updates user's permissions with given ID or the current user.
        Admin privileges required for this operation.
      operationId: adminUser
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - isAdmin
            properties:
              acsTok:
                maxLength: 256
                description: Access token obtain via '/api/signin' call
                type: string
              id:
                description: >-
                  Optional ID of the user to update. Current user is used ID by default.
                type: integer
                format: int64
              isAdmin:
                description: Admin privileges flag to update to
                type: boolean
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /user/add:
    post:
      tags:
        - Users
      summary: Adds new regular user.
      description: Adds new user with given parameters. Admin privileges required.
      operationId: addUser
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - email
              - passwd
              - firstName
              - lastName
              - isAdmin
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
              email:
                type: string
                description: User email
                maxLength: 64
              passwd:
                type: string
                description: User password
              firstName:
                type: string
                description: User first or given name
                maxLength: 64
              lastName:
                type: string
                description: User last name
                maxLength: 64
              avatarUrl:
                type: string
                description: Optional user avatar URL
                maxLength: 512000
              isAdmin:
                type: boolean
                description: Admin flag
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
              - userId
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
              userId:
                type: integer
                format: int64
                description: ID of the newly created user
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /endpoint/register:
    post:
      tags:
        - Asking
      summary: Register user endpoint.
      description: >-
        Register session endpoint for query results.
        Note that only one endpoint per user is allowed.
        Previous endpoint will be overridden, if any.
      operationId: registerEndpoint
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - endpoint
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
              endpoint:
                type: string
                description: User endpoint URL.
                maxLength: 2083
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /endpoint/remove:
    post:
      tags:
        - Asking
      summary: Removes user endpoint.
      description: >-
        Removes session endpoint. Command is ignored if endpoint is not registered.
        Note that only one endpoint per use is allowed.
      operationId: removeEndpoint
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /signin:
    post:
      tags:
        - Authentication
      summary: Signs in and obtains new access token.
      description: >-
        Accepts user's email and password and returns a **new access** token
        that should be used in all subsequent API calls. An access token can
        expire or be invalidated on the server side and this call should be used
        to obtain it again in such cases.
      operationId: signIn
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - email
              - passwd
            properties:
              email:
                maxLength: 64
                description: User sign in email.
                type: string
              passwd:
                maxLength: 64
                description: User password.
                type: string
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
              - acsTok
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
              acsTok:
                type: string
                description: >-
                  Temporary (session) access token that should be used for
                  further REST calls
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /signout:
    post:
      tags:
        - Authentication
      summary: Signs out and releases access token.
      description: >-
        Releases previously obtained access token. After this call given access
        token is no longer valid for authentication.
      operationId: signOut
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
            properties:
              acsTok:
                maxLength: 256
                description: Previously obtained access token to release.
                type: string
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /passwd/reset:
    post:
      tags:
        - Authentication
      summary: Resets password for the user.
      description: >-
        Resets the password for the user. Note that NLPCraft doesn't store password in reversible way
        and there is no way to retrieve the current password - user can only reset the password.
      operationId: passwdReset
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - newPasswd
            properties:
              acsTok:
                maxLength: 256
                description: Previously obtained access token to release.
                type: string
              id:
                description: >-
                  Optional ID of the user to reset password. Only admins
                  can provide this parameter. User's own ID by default.
                type: integer
                format: int64
              newPasswd:
                type: string
                description: User password
                maxLength: 64
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /probe/all:
    post:
      tags:
        - Data Probes
      summary: Gets all probes.
      description: >-
        Gets metadata for all active (currently connected) probes. Admin privileges required.
      operationId: getAllProbes
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
            properties:
              acsTok:
                maxLength: 256
                description: Access token obtain via '/api/signin' call
                type: string
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
              - probes
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
              dataSources:
                type: array
                items:
                  type: object
                  required:
                    - probeToken
                    - probeId
                    - probeGuid
                    - probeApiVersion
                    - probeApiDate
                    - osVersion
                    - osName
                    - osArch
                    - startTstamp
                    - tmzId
                    - tmzAbbr
                    - tmzName
                    - userName
                    - javaVersion
                    - javaVendor
                    - hostName
                    - hostAddr
                    - macAddr
                    - models
                  properties:
                    probeToken:
                      description: Probe token
                      type: string
                    probeId:
                      description: Probe ID (user defined ID)
                      type: string
                    probeGuid:
                      description: Probe GUID (globally unique internal ID)
                      type: string
                    probeApiVersion:
                      description: Probe API version
                      type: string
                    probeApiDate:
                      description: Probe API date
                      type: string
                    osVersion:
                      description: OS version
                      type: string
                    osName:
                      description: OS name
                      type: string
                    osArch:
                      description: OS architecture
                      type: string
                    startTstamp:
                      description: Start time in UTC.
                      type: integer
                      format: int64
                    tmzId:
                      description: Timezone ID
                      type: string
                    tmzAbbr:
                      description: Timezone abbreviation
                      type: string
                    tmzName:
                      description: Timezone name
                      type: string
                    userName:
                      description: User name
                      type: string
                    javaVersion:
                      description: Java version
                      type: string
                    javaVendor:
                      description: Java vendor
                      type: string
                    hostName:
                      description: Host name
                      type: string
                    hostAddr:
                      description: Host address
                      type: string
                    macAddr:
                      description: MAC address
                      type: string
                    models:
                      description: Models
                      type: array
                      items:
                        type: object
                        required:
                          - id
                          - name
                          - version
                        properties:
                          id:
                            description: Model ID (unique, immutable ID)
                            type: string
                          name:
                            description: Model name (descriptive name of this model)
                            type: string
                          version:
                            description: Model version
                            type: string
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /ds/all:
    post:
      tags:
        - Data Sources
      summary: Gets all data sources.
      description: Gets all data sources. Admin privileges required.
      operationId: getAllDataSources
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
            properties:
              acsTok:
                maxLength: 256
                description: Access token obtain via '/api/signin' call
                type: string
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
              - dataSources
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
              dataSources:
                type: array
                items:
                  type: object
                  required:
                    - id
                    - name
                    - shortDesc
                    - mdlId
                    - mdlName
                    - mdlVer
                    - mdlCfg
                  properties:
                    id:
                      description: Data source ID
                      type: integer
                      format: int64
                    name:
                      description: Data source name
                      type: string
                    shortDesc:
                      description: Short data source description
                      type: string
                    mdlId:
                      description: Model ID (unique, immutable ID)
                      type: string
                    mdlName:
                      description: Model name (descriptive name of this model)
                      type: string
                    mdlVer:
                      description: Model version
                      type: string
                    mdlCfg:
                      description: Model config (optional arbitrary string)
                      type: string
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /ds/delete:
    post:
      tags:
        - Data Sources
      summary: Deletes data source.
      description: Deletes data source with given ID. Admin privileges required.
      operationId: deleteDataSource
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - id
            properties:
              acsTok:
                maxLength: 256
                description: Access token obtain via '/api/signin' call
                type: string
              id:
                description: ID of the data source to delete
                type: integer
                format: int64
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /ds/update:
    post:
      tags:
        - Data Sources
      summary: Updates data source.
      description: Updates data source with given parameters. Admin privileges required.
      operationId: updateDataSource
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - id
              - name
              - shortDesc
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
              id:
                type: integer
                format: int64
                description: ID of the data source to update
              name:
                type: string
                description: Data source name to update
                maxLength: 128
              shortDesc:
                type: string
                description: Short data source description to update
                maxLength: 128
      responses:
        '200':
          description: Successful operation.
          schema:
            $ref: '#/definitions/Ok'
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
  /ds/add:
    post:
      tags:
        - Data Sources
      summary: Adds new data source.
      description: Adds new data source with given parameters. Admin privileges required.
      operationId: addDataSource
      parameters:
        - in: body
          name: Payload body
          description: JSON request.
          required: true
          schema:
            type: object
            required:
              - acsTok
              - name
              - shortDesc
              - mdlId
              - mdlName
              - mdlVer
            properties:
              acsTok:
                type: string
                description: Access token obtain via '/api/signin' call
                maxLength: 256
              name:
                type: string
                description: Data source name
                maxLength: 128
              shortDesc:
                type: string
                description: Short data source description
                maxLength: 128
              mdlId:
                type: string
                description: Model ID
                maxLength: 32
              mdlName:
                type: string
                description: Model name
                maxLength: 64
              mdlVer:
                type: string
                description: Model version
                maxLength: 16
              mdlCfg:
                type: string
                description: Optional model configuration string
                maxLength: 5120
      responses:
        '200':
          description: Successful operation.
          schema:
            type: object
            required:
              - status
              - dsId
            properties:
              status:
                type: string
                description: Status code of this operation
                enum:
                  - API_OK
              dsId:
                type: integer
                format: int64
                description: ID of the newly created data source
        '400':
          description: Failed operation.
          schema:
            $ref: '#/definitions/Error'
definitions:
  Ok:
    type: object
    required:
      - status
    properties:
      status:
        type: string
        description: Status code of this operation
        enum:
          - API_OK
  Error:
    type: object
    required:
      - status
    properties:
      status:
        type: string
        description: Status code of this error
        enum:
          - NC_UNKNOWN_ACCESS_TOKEN
          - NC_SIGNIN_FAILURE
          - NC_NOT_IMPLEMENTED
          - NC_INVALID_FIELD
          - NC_ADMIN_REQUIRED
          - NC_INVALID_OPERATION
          - NC_ERROR
          - NC_UNEXPECTED_ERROR
      reason:
        type: string
        description: Reason for this error
